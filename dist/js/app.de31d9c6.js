(function(){"use strict";var e={2602:function(e,t,o){var n=o(3751),i=o(5220),a=o(641);function r(e,t,o,n,i,r){const s=(0,a.g2)("RouterView");return(0,a.uX)(),(0,a.Wv)(s)}var s={name:"App"},l=o(6262);const d=(0,l.A)(s,[["render",r]]);var u=d,c=o(33);const h={key:0};function p(e,t,o,n,i,r){return(0,a.uX)(),(0,a.CE)("div",null,[t[2]||(t[2]=(0,a.Lk)("h1",null,"Upload Video",-1)),(0,a.Lk)("input",{type:"file",onChange:t[0]||(t[0]=(...e)=>r.onFileChange&&r.onFileChange(...e))},null,32),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.uploadVideo&&r.uploadVideo(...e))},"Upload"),i.message?((0,a.uX)(),(0,a.CE)("p",h,(0,c.v_)(i.message),1)):(0,a.Q3)("",!0)])}o(4114);var y=o(4335),g={data(){return{selectedFile:null,message:""}},methods:{onFileChange(e){this.selectedFile=e.target.files[0]},async uploadVideo(){if(!this.selectedFile)return void(this.message="Please select a file first!");const e=new FormData;e.append("file",this.selectedFile);try{const t=await y.A.post("http://127.0.0.1:5000/upload",e,{headers:{"Content-Type":"multipart/form-data"}}),o=t.data.file_url;console.log(o),this.message="Upload successful!",this.$emit("videoUploaded",o),this.$router.push({path:"/keypoints",query:{videoUrl:o}})}catch(t){this.message=`Error: ${t.response?.data?.error||"Unknown error"}`}}}};const v=(0,l.A)(g,[["render",p]]);var f=v;const m={class:"videoplayer-controls"},P=["onClick"],k={class:"videoplayer-controls-time"},b=["onClick"],C={key:0,class:"download-processed-button"},w={class:"progress-container"};function T(e,t,o,n,i,r){const s=(0,a.g2)("videoplayer-track"),l=(0,a.g2)("VideoPlayer");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(l,{class:"videoplayer",path:i.videoUrl,muted:!1,autoplay:!1,controls:!0,loop:!1,onPlay:r.onPlayerPlay,onPause:r.onPlayerPause,onEnded:r.onPlayerEnded,onLoadeddata:r.onPlayerLoadeddata,onWaiting:r.onPlayerWaiting,onPlaying:r.onPlayerPlaying,onTimeupdate:r.onPlayerTimeupdate,onCanplay:r.onPlayerCanplay,onCanplaythrough:r.onPlayerCanplaythrough,onStatechanged:r.playerStateChanged},{controls:(0,a.k6)((({togglePlay:e,playing:t,percentagePlayed:o,seekToPercentage:n,duration:r,convertTimeToDuration:l,videoMuted:d,toggleMute:u})=>[(0,a.Lk)("div",m,[(0,a.Lk)("button",{onClick:t=>e(),class:"videoplayer-controls-toggleplay"},(0,c.v_)(t?"pause":"play"),9,P),(0,a.Lk)("div",k,(0,c.v_)(l(i.time))+" / "+(0,c.v_)(l(r)),1),(0,a.bF)(s,{percentage:o,onSeek:n,class:"videoplayer-controls-track"},null,8,["percentage","onSeek"]),(0,a.Lk)("button",{onClick:e=>u(),class:"videoplayer-controls-togglemute"},(0,c.v_)(d?"unmute":"mute"),9,b),i.progress>=100?((0,a.uX)(),(0,a.CE)("button",C," Process Finished ")):(0,a.Q3)("",!0)])])),_:1},8,["path","onPlay","onPause","onEnded","onLoadeddata","onWaiting","onPlaying","onTimeupdate","onCanplay","onCanplaythrough","onStatechanged"]),(0,a.Lk)("div",w,[(0,a.Lk)("div",{class:"progress-bar",style:(0,c.Tr)({width:i.progress+"%"})},null,4)])],64)}const x=["src","muted","autoplay","controls","loop","width","height","poster","preload"];function U(e,t,o,n,i,r){return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.Lk)("video",{src:i.videoUrl,muted:o.muted,autoplay:o.autoplay,controls:o.controls,loop:o.loop,width:o.width,height:o.height,poster:o.poster,preload:o.preload,playsinline:!0,ref:"player"},null,8,x),(0,a.RG)(e.$slots,"controls",{play:r.play,pause:r.pause,togglePlay:r.togglePlay,playing:i.playing,percentagePlayed:i.percentagePlayed,seekToPercentage:r.seekToPercentage,duration:i.duration,convertTimeToDuration:r.convertTimeToDuration,videoMuted:i.videoMuted,toggleMute:r.toggleMute})])}const E=["play","pause","ended","loadeddata","waiting","playing","timeupdate","canplay","canplaythrough","statechanged"];var $={name:"VideoPlayer",props:{src:{type:String,required:!1},controls:{type:Boolean,required:!1,default:!1},loop:{type:Boolean,required:!1,default:!1},width:{type:Number,required:!1,default:500},height:{type:Number,required:!1,default:281},autoplay:{type:Boolean,required:!1,default:!1},muted:{type:Boolean,required:!1,default:!1},poster:{type:String,required:!1},preload:{type:String,required:!1,default:"auto"}},data(){return{playing:!1,duration:0,percentagePlayed:0,videoMuted:!1,videoUrl:null,time:0}},created(){console.log(this.$route.query),this.videoUrl=this.$route.query.videoUrl,console.log("Video URL:",this.videoUrl)},mounted(){this.bindEvents(),this.$refs.player.muted&&this.setMuted(!0)},methods:{bindEvents(){E.forEach((e=>{this.bindVideoEvent(e)}))},bindVideoEvent(e){const t=this.$refs.player;t.addEventListener(e,(o=>{"loadeddata"===e&&(this.duration=t.duration),"timeupdate"===e&&(this.percentagePlayed=t.currentTime/t.duration*100,this.time=t.currentTime),this.$emit(e,{event:o,player:this})}),!0)},play(){this.$refs.player.play(),this.setPlaying(!0)},pause(){this.$refs.player.pause(),this.setPlaying(!1)},togglePlay(){this.playing?this.pause():this.play()},setPlaying(e){this.playing=e},seekToPercentage(e){this.$refs.player.currentTime=e/100*this.duration},convertTimeToDuration(e){return[parseInt(e/60%60,10),parseInt(e%60,10)].join(":").replace(/\b(\d)\b/g,"0$1")},mute(){this.$refs.player.muted=!0,this.setMuted(!0)},unmute(){this.$refs.player.muted=!1,this.setMuted(!1)},toggleMute(){this.videoMuted?this.unmute():this.mute()},setMuted(e){this.videoMuted=e}}};const S=(0,l.A)($,[["render",U]]);var q=S,M={components:{VideoPlayer:q},data(){return{videoUrl:null,time:0,progress:0}},created(){this.videoUrl=this.$route.query.videoUrl?`http://127.0.0.1:5000/videos/${this.$route.query.videoUrl}`:null,console.log("url:::",this.videoUrl),this.startProgressStream(),console.log("started processing stream")},methods:{startProgressStream(){const e=new EventSource("http://localhost:5000/stream");e.onmessage=t=>{this.progress=parseInt(t.data),this.progress>=100&&(this.videoUrl="processed.mp4",e.close())}},onPlayerPlay({event:e,player:t}){console.log(e.type),t.setPlaying(!0)},onPlayerPause({event:e,player:t}){console.log(e.type),t.setPlaying(!1)},onPlayerEnded({event:e,player:t}){console.log(e.type),t.setPlaying(!1)},onPlayerLoadeddata({event:e}){console.log(e.type)},onPlayerWaiting({event:e}){console.log(e.type)},onPlayerPlaying({event:e}){console.log(e.type)},onPlayerTimeupdate({event:e}){this.time=e.target.currentTime,console.log({event:e.type,time:e.target.currentTime})},onPlayerCanplay({event:e}){console.log(e.type)},onPlayerCanplaythrough({event:e}){console.log(e.type)},playerStateChanged({event:e}){console.log(e.type)}}};const L=(0,l.A)(M,[["render",T]]);var F=L;function D(e,t,o,n,i,r){const s=(0,a.g2)("MyCanvas");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(s,{backgroundFile:i.videoUrl},null,8,["backgroundFile"])])}const O={class:"canvas-container"};function V(e,t,o,n,i,r){return(0,a.uX)(),(0,a.CE)("div",O,[(0,a.Lk)("canvas",{ref:"canvas",onMousedown:t[0]||(t[0]=(...e)=>r.startDrawing&&r.startDrawing(...e)),onMouseup:t[1]||(t[1]=(...e)=>r.stopDrawing&&r.stopDrawing(...e)),onMouseleave:t[2]||(t[2]=(...e)=>r.stopDrawing&&r.stopDrawing(...e))}," Your browser doesn't support canvas ",544)])}var _={name:"MyCanvas",props:{backgroundFile:{type:String,required:!0}},data(){return{path:null,width:0,height:0,video:null,isDrawing:!1,ctx:null,startPoint:null,lastPoint:null,lineCount:0,maxLines:4,squareCoordinates:[]}},mounted(){this.video=document.createElement("video"),this.video.src=this.backgroundFile,this.path=this.backgroundFile,this.video.addEventListener("loadeddata",(()=>{this.width=this.video.videoWidth,this.height=this.video.videoHeight,console.log(this.width),console.log(this.height);const e=this.$refs.canvas;e.width=this.width,e.height=this.height,this.ctx=e.getContext("2d"),this.ctx.strokeStyle="red",this.ctx.drawImage(this.video,0,0,this.width,this.height)})),this.video.crossOrigin="anonymous",this.video.muted=!0,this.video.play()},methods:{loadVideoFrame(){this.video.crossOrigin="anonymous",this.video.muted=!0,this.video.play(),this.video.addEventListener("loadeddata",(()=>{this.video.pause(),this.ctx.drawImage(this.video,0,0,this.$refs.video.width,this.$refs.video.height)}))},startDrawing(e){if(this.lineCount>=this.maxLines)return;this.isDrawing=!0;const t=this.$refs.canvas.getBoundingClientRect(),o=e.clientX-t.left,n=e.clientY-t.top;if(!this.startPoint){this.startPoint={x:o,y:n},this.ctx.fillStyle="blue";const e=5;this.ctx.arc(o,n,e,0,2*Math.PI),this.ctx.fill()}this.lastPoint||(this.lastPoint={x:o,y:n}),this.ctx.beginPath(),this.ctx.moveTo(this.lastPoint.x,this.lastPoint.y)},stopDrawing(e){if(this.isDrawing){this.isDrawing=!1;const t=this.$refs.canvas.getBoundingClientRect(),o=e.clientX-t.left,n=e.clientY-t.top;this.ctx.fillStyle="blue";const i=5;this.ctx.arc(o,n,i,0,2*Math.PI),this.ctx.fill(),this.ctx.lineTo(o,n),this.ctx.stroke(),this.squareCoordinates.push({x:o,y:n}),this.lastPoint={x:o,y:n},this.lineCount+=1,this.lineCount===this.maxLines&&(this.ctx.lineTo(this.startPoint.x,this.startPoint.y),this.ctx.stroke(),this.ctx.closePath(),this.isDrawing=!1,this.lastPoint=null,console.log(this.squareCoordinates),this.sendSquareCoordinatesToBackend())}},sendSquareCoordinatesToBackend(){fetch("http://localhost:5000/perspective",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({coordinates:this.squareCoordinates})}).then((e=>{if(!e.ok)throw new Error("Hiba történt az adatok küldése során.");return e.json()})).then((e=>{console.log("Backend válasz:",e),console.log("backgrounfile: ",this.backgroundFile),this.$router.push({path:"/analyzer",query:{videoUrl:this.backgroundFile}})})).catch((e=>{console.error("Hiba:",e)}))}}};const j=(0,l.A)(_,[["render",V],["__scopeId","data-v-500c047e"]]);var X=j,A={name:"KeyPoints",components:{MyCanvas:X},data(){return{videoUrl:null}},created(){this.videoUrl=this.$route.query.videoUrl||"default-background.jpg"}};const B=(0,l.A)(A,[["render",D]]);var I=B;const z=["src"],W={key:1};function R(e,t,o,n,i,r){return i.videoUrl?((0,a.uX)(),(0,a.CE)("video",{key:0,src:i.videoUrl,autoplay:"",loop:"",muted:"",playsinline:"",class:"video-player"},null,8,z)):((0,a.uX)(),(0,a.CE)("p",W,"Nincs videó"))}var N={name:"VideoAnalyzer",data(){return{videoUrl:null}},mounted(){const e=this.$route.query.videoUrl;console.log("filename::: ",e),this.videoUrl=`http://localhost:5000/videos/${e}`,console.log("url:::",this.videoUrl)}};const H=(0,l.A)(N,[["render",R]]);var Y=H;const K=[{path:"/",redirect:"/upload"},{path:"/upload",component:f},{path:"/keypoints",component:I},{path:"/analyzer",component:F},{path:"/analyzed",component:Y}],Q=(0,i.aE)({history:(0,i.LA)(),routes:K}),G=(0,n.Ef)(u);G.use(Q),G.mount("#app")}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,o),a.exports}o.m=e,function(){var e=[];o.O=function(t,n,i,a){if(!n){var r=1/0;for(u=0;u<e.length;u++){n=e[u][0],i=e[u][1],a=e[u][2];for(var s=!0,l=0;l<n.length;l++)(!1&a||r>=a)&&Object.keys(o.O).every((function(e){return o.O[e](n[l])}))?n.splice(l--,1):(s=!1,a<r&&(r=a));if(s){e.splice(u--,1);var d=i();void 0!==d&&(t=d)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,i,a]}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,a,r=n[0],s=n[1],l=n[2],d=0;if(r.some((function(t){return 0!==e[t]}))){for(i in s)o.o(s,i)&&(o.m[i]=s[i]);if(l)var u=l(o)}for(t&&t(n);d<r.length;d++)a=r[d],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(u)},n=self["webpackChunkfoosball_client"]=self["webpackChunkfoosball_client"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[504],(function(){return o(2602)}));n=o.O(n)})();
//# sourceMappingURL=app.de31d9c6.js.map